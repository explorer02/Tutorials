<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>


<body>
    <script>

        var global = {};

        function deepCopy(src) {
            obj = {
                _id: src.id,
                _reading: src.reading,
                get id() {
                    return this._id;
                },
                set id(v) {
                    var change = (this._id !== v);
                    this._id = v;
                    if (change && !global.dom.timerID) {
                        global.dom.timerID = setTimeout(() => (global.dom.reflectChanges()), global.dom.time)
                    }
                },
                get reading() {
                    return this._reading;
                },
                set reading(v) {
                    var change = (this._reading !== v);
                    this._reading = v;
                    if (change && !global.dom.timerID) {
                        global.dom.timerID = setTimeout(() => global.dom.reflectChanges(), global.dom.time)
                    }
                },
            };
            return obj;
        }

        function StudentDOM(studs) {
            global.dom = this;
            this.studs = studs.map(el => deepCopy(el));
            this.timerID = null
            this.time = 2000
            this.reflectChanges()
        }
        function getStudentByID(id) {
            for (let stud of this.studs) {
                if (stud.id == id) {
                    return stud;
                }
            }
            return null;
        }
        function appendStudent(stud) {
            this.studs.push(deepCopy(stud))
            if (!this.timerID) {
                this.timerID = setTimeout(function () { this.reflectChanges() }.bind(this), this.time);
            }
        }
        function removeStudent(id) {
            for (let i = 0; i < this.studs.length; i++) {
                if (this.studs[i].id == id) {
                    this.studs.splice(i, 1);
                    if (!this.timerID) {
                        this.timerID = setTimeout(function () { this.reflectChanges() }.bind(this), this.time);
                    }
                    return;
                }
            }
        }
        function reflectChanges() {
            console.log(this.studs)
            this.timerID = undefined;
        }

        StudentDOM.prototype = { getStudentByID, appendStudent, removeStudent, reflectChanges }

        let studs = [
            { id: 1, reading: true },
            { id: 2, reading: false },
            { id: 3, reading: true },
            { id: 4, reading: false }
        ]

        dom = new StudentDOM(studs);

        let stud = { id: 5, name: "MNO" };



    </script>
</body>

</html>